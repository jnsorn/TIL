# 2021ë…„ 3ì›”

## 3ì¼ ìˆ˜ìš”ì¼

> Spring Batch [(ì •ë¦¬)](../spring/spring-batch/spring_batch_guide_tasklet.md)

7. Spring Batch ê°€ì´ë“œ - ItemReader
8. Spring Batch ê°€ì´ë“œ - ItemWriter
9. Spring Batch ê°€ì´ë“œ - ItemProcessor

## 9ì¼ í™”ìš”ì¼

> ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸ [(ì •ë¦¬)](../database/jpa/orm_jpa_basic.md)

- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´1 - ê¸°ë³¸ë¬¸ë²•
    - í˜ì´ì§•

## 10ì¼ ìˆ˜ìš”ì¼

> Spring Batch [(ì •ë¦¬)](../spring/spring-batch/spring_batch_guide_tasklet.md)

10. Spring Batch ê°€ì´ë“œ - Spring Batch í…ŒìŠ¤íŠ¸ ì½”ë“œ
11. Spring Batch ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ - Reader í¸

## 11ì¼ ëª©ìš”ì¼

> ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸ [(ì •ë¦¬)](../database/jpa/orm_jpa_basic.md)

- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´1 - ê¸°ë³¸ë¬¸ë²•
    - JPQL íƒ€ì… í‘œí˜„ê³¼ ê¸°íƒ€ì‹
    - JPQL í•¨ìˆ˜

> Spring Batch íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

ë°°ì¹˜ ì‹¤í–‰ì‹œ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ ë°œìƒ

```a job execution for this job is already running job instance id = ? ```

ì„œë²„ê°€ ë¹„ì •ìƒ ì¢…ë£Œëœ ê²½ìš° ê²°ê³¼ë¥¼ í…Œì´ë¸”ì— ì €ì¥í•˜ì§€ ëª»í•´ ë°œìƒ(SimpleJobLauncher)
```java
/*
* validate here if it has stepExecutions that are UNKNOWN, STARTING, STARTED and STOPPING
* retrieve the previous execution and check
  */
  for (StepExecution execution : lastExecution.getStepExecutions()) {
  BatchStatus status = execution.getStatus();
  if (status.isRunning() || status == BatchStatus.STOPPING) {
  throw new JobExecutionAlreadyRunningException("A job execution for this job is already running: "
  + lastExecution);
  } else if (status == BatchStatus.UNKNOWN) {
  throw new JobRestartException(
  "Cannot restart step [" + execution.getStepName() + "] from UNKNOWN status. "
  + "The last execution ended with a failure that could not be rolled back, "
  + "so it may be dangerous to proceed. Manual intervention is probably necessary.");
  }
  }
  ```
ë©”íƒ€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ìˆ˜ë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ì—¬ í•´ê²° ì‹œë„í–ˆì§€ë§Œ ë˜‘ê°™ì€ ì˜¤ë¥˜ê°€ ê³„ì† ë°œìƒ

```sql
UPDATE 
    BATCH_JOB_EXECUTION 
SET 
    END_TIME = SYSTIMESTAMP, 
    STATUS = 'FAILED', 
    EXIT_CODE = 'COMPLETED' 
WHERE 
   JOB_EXECUTION_ID =
      (SELECT 
         MAX(JOB_EXECUTION_ID) 
       FROM 
         BATCH_JOB_EXECUTION 
       WHERE 
         JOB_INSTANCE_ID = #{jobInstanceId}
      );

  ```

BATCH_JOB_EXECUTION í…Œì´ë¸” ì™¸ì˜ ëª¨ë“  ë©”íƒ€ í…Œì´ë¸”ì„ ì°¾ì•„ì„œ í•´ë‹¹ ì‘ì—…ì— ëŒ€í•œ ë ˆì½”ë“œë¥¼ ì‚­ì œ. 

ì‚­ì œí•˜ë‹¤ë³´ë‹ˆ BATCH_STEP_EXECUTION ì—ë„ ì´ë¯¸ ì‘ì—…ì´ ì‹œì‘ëœ ë ˆì½”ë“œê°€ ì¡´ì¬. 

ì•„ë§ˆ ì´ ë ˆì½”ë“œ ë•Œë¬¸ì— ê³„ì† ê±¸ë¦° ê²ƒ ê°™ì€ë° ì´ë¯¸ ì‚­ì œë¥¼ ì§„í–‰í•˜ê³  ìˆì–´ì„œ ê·¸ëƒ¥ ë‹¤ ì‚­ì œ. ì •ìƒ ë™ì‘

## ğŸ“¬ 1,2ì£¼ì°¨(1ì¼~14ì¼)

### ëª©í‘œ

- [x] Spring Batch ê°€ì´ë“œ 6~10
- [x] Real MySQL 4ì¥

### íšŒê³ 

- ì •ì‹ ì—†ë‹¤. 
